"use strict";(self.webpackChunksynergine=self.webpackChunksynergine||[]).push([[9700,2637],{9700:(e,t,i)=>{i.r(t),i.d(t,{default:()=>HtmlSliders});var s=i(4967),n=i(9875),l=i(767),d=i(2637),a=i(3330),r=i(1721),o=i(9755),h=i(6885);class HtmlSliders extends s.default{_init(){return this.$slider_list=o('[data-js="html-sliders-list"]'),new d.default({$wrapper:this.$slider_list,namespace:this.constructor.name}),!!this.$slider_list.length}_bind(){return this._liveBindTo('[data-js="slide-delete"]',"click",(e=>{this.deleteOrRestoreSlide(o(e.target))})),this._liveBindTo('[data-js="slide-restore"]',"click",(e=>{this.deleteOrRestoreSlide(o(e.target))})),this._bindTo(o(h),"modal:opened",((e,t)=>{let i=this._nullSafe((()=>t.$modal));this.initAddSlides(i)})),this._bindTo(o(h),"html_slider:created",((e,t)=>{h.location.reload()})),this._bindTo(o(h),"html_slider:updated",((e,t)=>{let i=this._nullSafe((()=>t.response.notification.data.html_slider)),s=this._nullSafe((()=>t.$modal)),n=this.$slider_list.find(`[data-js-id="${i.id}"]`).find("td");n.length&&n.text(i.name),s&&s.length&&s.close(null,(()=>{let e=this._route("admin:widget:html-slider:edit",{html_slider:i.id});new r.default({route:e.uri})}))})),this._bindTo(this.$slider_list,"clear:cache",((e,t)=>{let i=o(t.target),s=this._route("admin:html-slider:cache:clear",{html_slider:i.data("js-id")});new a.default({url:s.uri,method:s.method})})),!0}deleteOrRestoreSlide(e){let t=e.closest('[data-js="slide-delete-wrapper"]'),i=t.find("input");return e.is('[data-js="slide-delete"]')?(t.addClass("deleted"),i.val(1),!1):e.is('[data-js="slide-restore"]')?(t.removeClass("deleted"),i.val(0),!1):this}initAddSlides(e){let t=e.find('[data-js="html-sliders__file-input-add"]'),i=e.find("tbody");this._bindTo(t,"click",(()=>{let t=i.find("tr").last(),s=t.clone();s.removeAttr("style");let d=n.default.guid();s.find('[data-js-id="_html-sliders-content-0"]').attr("data-js-id",`_html-sliders-content-${d}`),s.find("#_html-sliders-content-0").attr("id",`_html-sliders-content-${d}`),s.find("fieldset").each(((e,t)=>{let i=n.default.guid(),s=o(t),l=s.find(":regex(for,^_html-sliders-)"),d=s.find(":regex(id,^_html-sliders-)"),a=s.find(".html-sliders-editor"),r=/^_html-sliders-(.+?)-(\d+)$/gi.exec(l.attr("for"));r&&(l.attr("for",`_html-sliders-${r[1]}-${i}"`),d.attr("id",`_html-sliders-${r[1]}-${i}"`),a.attr("data-js-id",`_html-sliders-${r[1]}-${i}"`))})),t.prev().find(":input").each(((e,t)=>{o(t);if(/^child_custom_fields\[/gi.test(t.name)){let e=/^child_custom_fields\[(\d+)\](.+?)$/gi.exec(t.name),i=parseInt(e[1]);s.find(`[name="child_custom_fields[0]${e[2]}"]`).attr("name",`child_custom_fields[${i+1}]${e[2]}`),s.find(`[data-js-name="child_custom_fields[0]${e[2]}"]`).attr("data-js-name",`child_custom_fields[${i+1}]${e[2]}`),s.find('[name="slides[]"]').attr("name",`slides[${i+1}]`),s.find('[name="slide_position[]"]').attr("name",`slide_position[${i+1}]`),s.find('[name="slides_for_delete[]"]').attr("name",`slides_for_delete[${i+1}]`)}})),s.insertBefore(t);let a=s.closest("form").find('[name="template_id"]').find("option:selected").data("cf-field");s.find(`[data-js-custom-field-options="${a}"]`).show(),o(h).trigger("image-preview:update"),o(h).trigger("image-select:init"),o("select[multiple]").chosen({search_contains:!0,no_results_text:"Не найдено соответствий запросу:",placeholder_text_multiple:"Выберите или начните вбивать…"}),new l.default({$scroll_element:e})}))}}},2637:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ContextMenu});var s=i(4967),n=i(9755),l=i(4771),d=i(6885);class ContextMenu extends s.default{_init(){return!(!this.options.$wrapper||!this.options.$wrapper.length)&&(this.options.namespace=this.options.namespace||null,this.$menu=this.options.$wrapper.find('[data-js="context-menu"]'),!!this.$menu.length&&(this.menu_open_selector="context-menu_active",this.task_item_selector='[data-js-context-menu="item"]',this.link_selector='[data-js-context-menu="link"]',this.$item_in_context=null,this.$link_in_context=null,this.menu_state=0,!0))}_bind(){return this.contextListener(),this.clickListener(),this.keyupListener(),this.resizeListener(),!0}contextListener(){let callback=e=>{this.$item_in_context=this.clickInsideElement(e,this.task_item_selector),this.$item_in_context?(e.preventDefault(),this.toggleMenuOn(),this.positionMenu(e)):(this.$item_in_context=null,this.toggleMenuOff())};this._bindTo(n(l),"contextmenu",callback),this._onTwoFingersTap(n(l),callback)}clickListener(){this._bindTo(n(l),"click",(e=>{if(this.$link_in_context=this.clickInsideElement(e,this.link_selector),this.$link_in_context)e.preventDefault(),this.menuItemListener();else{1===(e.which||e.button)&&this.toggleMenuOff()}}))}menuItemListener(){let e=this.options.namespace?`.${this.options.namespace}`:"";this.options.$wrapper.trigger(`${this.$link_in_context.attr("data-js-action")}${e}`,{target:this.$item_in_context}),this.toggleMenuOff()}keyupListener(){this._bindTo(n(d),"keyup",(e=>{27===e.keyCode&&this.toggleMenuOff()}))}resizeListener(){this._bindTo(n(d),"resize",(e=>{this.toggleMenuOff()}))}toggleMenuOn(){n("[data-context-menu-target]").each(((e,t)=>{n(t).removeAttr("data-context-menu-target")})),this.$item_in_context.attr("data-context-menu-target",!0),1!==this.menu_state&&(this.menu_state=1,this.$menu.addClass(this.menu_open_selector))}toggleMenuOff(){this.$item_in_context&&this.$item_in_context.removeAttr("data-context-menu-target"),0!==this.menu_state&&(this.menu_state=0,this.$menu.removeClass(this.menu_open_selector))}positionMenu(e){let t=this.getPosition(e),i=t.x,s=t.y,n=this.$menu.get(0).offsetWidth+4,l=d.innerWidth;l-i<n?this.$menu.css({left:l-n}):this.$menu.css({left:i}),this.$menu.css({top:s})}clickInsideElement(e,t){let i=n(e.target);if(i.is(t))return i;let s=i.closest(t);return!!s.length&&s}getPosition(e=d.event){let t,i;return e.pageX||e.pageY?(t=e.pageX,i=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+l.body.scrollLeft+l.documentElement.scrollLeft,i=e.clientY+l.body.scrollTop+l.documentElement.scrollTop),{x:t,y:i}}}}}]);