"use strict";(self.webpackChunksynergine=self.webpackChunksynergine||[]).push([[7757],{7757:(e,t,s)=>{s.r(t),s.d(t,{default:()=>SearchInput});var l=s(4967),i=s(3330),a=s(9755),r=s(6885);class SearchInput extends l.default{_init(){return this.selector='[data-js="search-input"]',this.selector_input_result='[data-js="search-input-result"]',this.selector_set_model='[data-js-search-input="set-model"]',this.selector_result="search-input__result",!0}_bind(){return this._liveBindTo(this.selector_set_model,"change",(e=>{let t=a(e.target),s=t.find("option:selected"),l=t.closest('[data-js-search-input-set-model="wrapper"]'),i=s.data("js-search-input-field"),r=t.val(),n=this._route("admin:search-input",{model:r,field:i}),h=l.find("[data-js-search-input-url]");"null"===r?h.closest("fieldset").hide():h.closest("fieldset").show(),h.data("js-search-input-url",n.uri)})),this._liveBindTo(this.selector,"focus",(e=>{this.getResult(e).show();let t=a(e.target),s=t.closest(".search-input"),l=s.find(`.${this.selector_result}`),i=l.find("[data-search-element]"),n=s.find(this.selector_input_result),h=l.find(".search-input__placeholder");this._bindTo(a(r),"search-input:single-item",((e,s)=>{let l=this._nullSafe((()=>s.$result_wrapper)),i=this._nullSafe((()=>s.text)),r=this._nullSafe((()=>s.id)),h=a.trim(t.val());if(i&&r&&h&&i===h){l.find(`[data-search-element-id="${r}"]`).length&&n.val(r)}})),this._bindTo(t,"keypress",(e=>{if(13===e.keyCode)return e.preventDefault(),this.selectResult(i.filter(".active"),t,n,l),!1})),this._bindTo(t,"change",(e=>{a.trim(t.val())||n.trigger("select-result")})),this._bindTo(t,"keydown",(e=>{9===e.keyCode&&l.hide()})),this._bindTo(t,"keyup",this._debounce((e=>{let s=a(e.target),r=s.val();return 13!==e.keyCode&&(a.trim(r)||n.val(""),i=l.find("[data-search-element]"),this.navigate(e,i)?(e.preventDefault(),!1):(r.length||(l.find("[data-search-element]").remove(),h.text("Введите текст для поиска").show()),!(!a.trim(r)||r.length<3)&&(this.url=s.data("js-search-input-url"),void this.search(r,h,l,t))))})))})),this._liveBindTo(`.${this.selector_result} li`,"click",(e=>{let t=a(e.currentTarget),s=t.closest(".search-input"),l=s.find("> input:first-child"),i=s.find(`.${this.selector_result}`),r=s.find(this.selector_input_result);return!(!i||!i.length)&&(!t.is(".search-input__placeholder")&&void this.selectResult(t,l,r,i))})),this._liveBindTo("body","click",(e=>{let t=a(e.target);if(t.closest(".search-input__result").length||t.is(this.selector)){if(t.is(this.selector)){let e=t.closest(".search-input").find(".search-input__result");a(`.${this.selector_result}`).hide(),e.show()}}else a(`.${this.selector_result}`).hide()})),!0}getResult(e){let t,s=a(e.target).closest(".search-input");return s.find(`.${this.selector_result}`).length?t=s.find(`.${this.selector_result}`):(s.append(a("<ul/>",{class:this.selector_result})),t=s.find(`.${this.selector_result}`),t.append(a("<li/>",{class:"search-input__placeholder"}).text("Введите текст для поиска"))),t}selectResult(e,t,s,l){if(!e.length){let t=l.find("li[data-search-element-id]");1===t.length&&(e=t)}t.val(e.text());let i=s.data("js-search-input-result-key");i=i||"id",s.val(e.data(`search-element-${i}`)),t.trigger("select-result"),s.trigger("select-result"),e.trigger("select-result"),l.hide(),this.openEditResourceWindow(l,t,s)}search(e,t,s,l){t.text("Поиск…").show();let n,h,c=t.closest(".modal");return c.length&&(h=c.find('[data-js="ace-button"]')),this.url.match(/Synergine:Page:Models:Page/gi)?s.closest(".search-input").addClass("search-input_page-search"):s.closest(".search-input").removeClass("search-input_page-search"),new i.default({url:this.url,data:{query:e},error_class:"form__error_admin",success:l=>{let i=this._nullSafe((()=>l.data.list));s.find("[data-search-element]").remove(),i.length?(t.hide(),i.forEach((t=>{let l=this._nullSafe((()=>t._text)),n=this._nullSafe((()=>t._id));if(l){l=a("<span/>").html(l).html();let i=l.replace(new RegExp(`(${e})`,"gi"),'<span class="hl">$1</span>'),r={"data-search-element":!0};a.each(t,((e,t)=>{"_text"!==e&&"_id"!==e&&(r[`data-search-element-${e}`]=t,r["data-search-element-id"]=n)})),s.append(a("<li/>",r).html(i))}1===i.length&&a(r).trigger("search-input:single-item",{$result_wrapper:s,text:l,id:n})})),n=s.find("[data-search-element]"),this.enableButton(h)):(t.text("Ничего не найдено").show(),this.disableButton(h)),s.show()},complete:(e,t)=>{}}),n}navigate(e,t){let s=e.keyCode;if(40!==s&&38!==s)return!1;let l,i=t.filter(".active");return t.removeClass("active"),40===s?l=!i.length||i.is(":last-child")?t.eq(0):i.next():38===s&&(!i.length||i.is(":first-child")?l=t.last():(l=i.prev(),l.is(".search-input__placeholder")&&(l=t.last()))),l.addClass("active"),!0}enableButton(e){e&&e.length&&e.prop("disabled",!1)}disableButton(e){e&&e.length&&e.prop("disabled",!0)}openEditResourceWindow(e,t,s){let l=t.data("js-search-input-edit-route"),i=t.data("js-search-input-edit-field");if(l&&i){let a=s.val(),r={},n=e.closest(".search-input").find('[data-js="ajax-link"]');r[i]=a;let h=this._route(l,r);n.attr("href",h.uri),"javascript:void(0);"!==n.attr("href")&&(n.trigger("click"),n.attr("href","javascript:void(0);"),t.val(""),s.val(""))}}}}}]);