"use strict";(self.webpackChunksynergine=self.webpackChunksynergine||[]).push([[7864],{7864:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Tree});var d=s(4967),a=s(3330),i=s(1721),n=s(6885),r=s(9755);class Tree extends d.default{_init(){return!(!this.options.$tree||!this.options.data_js_item)&&(this.coloringList(),!0)}addPageToLsTree(e,t){let s=n.__storage.get(e,[]);s.includes(t)||(t=[t],s=s.concat(t),n.__storage.set(e,s))}removePageFromLsTree(e,t){let s=n.__storage.get(e,[]);if(s.includes(t)){let d=s.indexOf(t);!1!==d&&s.splice(d,1),n.__storage.set(e,s)}}getDescendants(e,t="trash"){let s=e.data("js-id"),d=e.data("js-descendants-url"),i=r(`[data-js-sub-for="${s}"]`);return!e.is(".in-progress")&&(e.is(".opened")?(i.html(""),e.removeClass("opened"),this.coloringList(),this.removePageFromLsTree(`${t}-tree`,s),!1):(i.html(""),e.addClass("opened"),e.addClass("in-progress"),this.addPageToLsTree(`${t}-tree`,s),void new a.default({url:d,success:d=>{let a=this._nullSafe((()=>d.data.tree));if(a){let t=i.length?i:this.getUlTpl(s);r.each(a,((e,s)=>{this.options.$tree.find(`[data-js-id=${s.id}]`).remove();let d="";!1===this._nullSafe((()=>s.published))&&(d="off"),t.append(this.getLiTpl(s,d))})),t.insertAfter(e),this.coloringList(),e.addClass("tree__item_with-descendants opened")}else this.removePageFromLsTree(`${t}-tree`,s),e.removeClass("tree__item_with-descendants opened");setTimeout((()=>{e.removeClass("in-progress")}),600)}})))}addDescendant(e,t){let s=e.data("js-id");new i.default({route:t,data:{parent_id:s},callback:t=>{this._bindTo(t,"form:done",(()=>{e.addClass("tree__item_with-descendants"),this.getDescendants(e)}))}})}addRoot(e,t="a"){let s,d,a=this.options.$tree.find(" > li"),i="";!1===this._nullSafe((()=>e.published))&&(i="off");let n=this.getLiTpl(e,i);a.each(((e,a)=>{if(d)return!0;let i=r(a),n=r.trim(i.text()).toLowerCase(),l=r.trim(t).toLowerCase();(Number.isInteger(n)||n>l)&&(s=i,d=!0)})),s?n.insertBefore(s):this.options.$tree.append(n),this.coloringList()}getUlTpl(e){return r("<ul/>",{class:"tree__sub","data-js-sub-for":e})}getLiTpl(e,t=""){let s=r("<li/>",{"data-js-context-menu":"item","data-js":this.options.data_js_item,"data-js-id":e.id,"data-js-page-descendants":e.descendants_count,"data-js-edit-url":e.edit_url,"data-js-descendants-url":e.descendants_url}),d=e.name||e.h1;return s.html(r("<span/>").html(d).text()),s.prepend(r("<div/>",{class:"tree__pusher"})),e.descendants_count&&s.addClass("tree__item_with-descendants"),t&&s.addClass(t),s}coloringList(){this.options.$tree.find("li").each(((e,t)=>{let s=r(t),d=s.position().left,a=s.find(".tree__pusher");d?a.length?a.css({width:d,left:-d}):s.prepend(r("<div/>",{class:"tree__pusher"}).css({width:d,left:-d})):a.length&&a.css({width:0,left:0}),e%2==0?r(t).removeClass("odd even").addClass("odd"):r(t).removeClass("odd even").addClass("even")}))}}}}]);