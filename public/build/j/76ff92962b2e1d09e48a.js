"use strict";(self.webpackChunksynergine=self.webpackChunksynergine||[]).push([[7391,3064,2637,7864],{7391:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Pages});var i=s(4967),a=s(2637),n=s(1721),r=s(3330),l=s(7864),d=s(3064),o=s(9755),h=s(6885);class Pages extends i.default{_init(){return this.$wrapper=o('[data-js="pages-list-wrapper"]'),this.$wallpaper_video=!1,!!this.$wrapper.length&&(this.create_page_route=o(".create-button").attr("href"),this.$tree=this.$wrapper.find(".tree"),this.data_js_item="page-item",this.Tree=new l.default({$tree:this.$tree,data_js_item:this.data_js_item}),new a.default({$wrapper:this.$wrapper,namespace:this.constructor.name}),!0)}_bind(){this._bindTo(o(h),"load",(()=>{let e=h.__storage.get("page-tree");e&&(o.isArray(e)||(e=[e]),o.each(e,((e,t)=>{let s=this.$wrapper.find(`[data-js-id=${t}]`);s.length?this.Tree.getDescendants(s,"page"):h[`interval-page-tree_${t}`]=setInterval((()=>{let e=this.$wrapper.find(`[data-js-id=${t}]`);e.length&&(this.Tree.getDescendants(e,"page"),clearInterval(h[`interval-page-tree_${t}`]))}),100)})))})),this._bindTo(o(h),"modal:opened",((e,t)=>{let s=t.$modal.find("form");this.initGenerateSlug(s)})),this._bindTo(o(h),"page:created",((e,t)=>{let s=this._nullSafe((()=>t.response.notification.data.page)),i=this._nullSafe((()=>t.$modal)),a=i.find("form"),n=o("<span/>").html(a.find('input[name="h1"]').val()).text();s.parent_id||this.Tree.addRoot(s,n),i.close()})),this._bindTo(o(h),"page:updated",((e,t)=>{let s=this._nullSafe((()=>t.response.notification.data.page)),i=this._nullSafe((()=>t.$modal)),a=this.$wrapper.find(`[data-js-id="${s.id}"]`);if(i.close(null,(()=>{let e=this._route("admin:page:edit",{page:s.id});new n.default({route:e.uri})})),a.length){a.toggleClass("off",!s.published);let e=a.attr("class");a.replaceWith(this.Tree.getLiTpl(s,e)),a=this.$wrapper.find(`[data-js-id="${s.id}"]`);let t=a.closest("[data-js-sub-for]"),i=null;if(t.length){if(i=t.data("js-sub-for"),parseInt(s.parent_id)!==i){let e=this.$wrapper.find(`[data-js-id="${i}"]`),t=this.$wrapper.find(`[data-js-id="${s.parent_id}"]`);e.removeClass("opened"),this.Tree.getDescendants(e,"page"),t.length?this.Tree.getDescendants(t,"page"):this.Tree.addRoot(s,s.h1)}}else{let e=parseInt(s.parent_id);if(i=parseInt(i),!isNaN(e)&&e!==i){let e=this.$wrapper.find(`[data-js-id="${s.parent_id}"]`);this.Tree.getDescendants(e,"page")}}this.Tree.coloringList()}})),this._bindTo(this.$wrapper,"add:descendant",((e,t)=>{let s=o(t.target);this.Tree.addDescendant(s,this.create_page_route)})),this._bindTo(this.$wrapper,"edit",((e,t)=>{let s=o(t.target);new n.default({route:s.data("js-edit-url")})})),this._bindTo(this.$wrapper,"open",((e,t)=>{let s=o(t.target),i=this._route("admin:page:url",{page:s.data("js-id")});new r.default({url:i.uri,method:i.method,success:e=>{let t=this._nullSafe((()=>e.data.url));t&&h.open(t,"previeWin")}})})),this._bindTo(this.$wrapper,"clear:cache",((e,t)=>{let s=this._route("admin:cache:reset:selected");s&&new r.default({url:s.uri,method:s.method,data:{page_id:o(t.target).data("js-id")}})})),this._liveBindTo(`[data-js="${this.data_js_item}"]`,"click",(e=>{let t=o(e.target);return 2!==e.button&&(!!t.is(`[data-js="${this.data_js_item}"]`)&&void this.Tree.getDescendants(t,"page"))})),this._liveBindTo('[data-js="wallpaper-video-delete"]',"click",(e=>{this.deleteOrRestoreWallpaperVideo(o(e.target))}));let e=this._getHashParams(),t=this._nullSafe((()=>e.edit_page));return t&&d.default.call(t),!0}initGenerateSlug(e){let t=e.find('[name="h1"]'),s=e.find('[name="slug"]'),i=e.find('[name="v_parent_id"]');if(!s.length)return!1;let submit=()=>{let e=o("<span/>").html(t.val()).text(),a=t.data("js-get-slug-url"),n=i.val();if(!o.trim(e))return!1;n&&(a=`${a}/${n}`),s.prop("disabled",!0),new r.default({url:a,data:{name:e},success:e=>{let t=this._nullSafe((()=>e.data.slug));t&&(t=t.replace(/\/$/,"")),s.val(t),s.trigger("change"),s.prop("disabled",!1)}})};if(o.trim(t.val()))return!1;this._bindTo(t,"keyup change",this._debounce(submit)),this._bindTo(i,"select-result",this._debounce(submit))}deleteOrRestoreWallpaperVideo(e){let t=e.closest('[data-js="wallpaper-video-delete-wrapper"]'),s=t.find("input");return e.is('[data-js="wallpaper-video-delete"]')&&0==this.$wallpaper_video?(this.$wallpaper_video=!0,e.text("Восстановить"),t.addClass("deleted"),t.prev("video").css({opacity:"0.5"}),s.val(1),!1):(this.$wallpaper_video=!1,e.text("Удалить"),t.removeClass("deleted"),t.prev("video").css({opacity:"1"}),s.val(0),!1)}}},3064:(e,t,s)=>{s.r(t),s.d(t,{default:()=>AjaxLinks});var i=s(4967),a=s(1721),n=s(7249),r=s(9755);class AjaxLinks extends i.default{_init(){return this.ajax_links='[data-js="ajax-link"]',!0}_bind(){return this._liveBindTo(this.ajax_links,"click",(e=>{e.preventDefault();let t=r(e.currentTarget);t.prop("disabled",!0);let s=t.attr("href")?t.attr("href"):t.data("js-href"),i=new n.default;return new a.default({route:s,callback:()=>{t.prop("disabled",!1),i.remove()}}),!1})),!0}static call(e,t=null){return!!r.trim(e)&&(new a.default({route:e,callback:()=>{r.isFunction(t)&&t()}}),!0)}}},2637:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ContextMenu});var i=s(4967),a=s(9755),n=s(4771),r=s(6885);class ContextMenu extends i.default{_init(){return!(!this.options.$wrapper||!this.options.$wrapper.length)&&(this.options.namespace=this.options.namespace||null,this.$menu=this.options.$wrapper.find('[data-js="context-menu"]'),!!this.$menu.length&&(this.menu_open_selector="context-menu_active",this.task_item_selector='[data-js-context-menu="item"]',this.link_selector='[data-js-context-menu="link"]',this.$item_in_context=null,this.$link_in_context=null,this.menu_state=0,!0))}_bind(){return this.contextListener(),this.clickListener(),this.keyupListener(),this.resizeListener(),!0}contextListener(){let callback=e=>{this.$item_in_context=this.clickInsideElement(e,this.task_item_selector),this.$item_in_context?(e.preventDefault(),this.toggleMenuOn(),this.positionMenu(e)):(this.$item_in_context=null,this.toggleMenuOff())};this._bindTo(a(n),"contextmenu",callback),this._onTwoFingersTap(a(n),callback)}clickListener(){this._bindTo(a(n),"click",(e=>{if(this.$link_in_context=this.clickInsideElement(e,this.link_selector),this.$link_in_context)e.preventDefault(),this.menuItemListener();else{1===(e.which||e.button)&&this.toggleMenuOff()}}))}menuItemListener(){let e=this.options.namespace?`.${this.options.namespace}`:"";this.options.$wrapper.trigger(`${this.$link_in_context.attr("data-js-action")}${e}`,{target:this.$item_in_context}),this.toggleMenuOff()}keyupListener(){this._bindTo(a(r),"keyup",(e=>{27===e.keyCode&&this.toggleMenuOff()}))}resizeListener(){this._bindTo(a(r),"resize",(e=>{this.toggleMenuOff()}))}toggleMenuOn(){a("[data-context-menu-target]").each(((e,t)=>{a(t).removeAttr("data-context-menu-target")})),this.$item_in_context.attr("data-context-menu-target",!0),1!==this.menu_state&&(this.menu_state=1,this.$menu.addClass(this.menu_open_selector))}toggleMenuOff(){this.$item_in_context&&this.$item_in_context.removeAttr("data-context-menu-target"),0!==this.menu_state&&(this.menu_state=0,this.$menu.removeClass(this.menu_open_selector))}positionMenu(e){let t=this.getPosition(e),s=t.x,i=t.y,a=this.$menu.get(0).offsetWidth+4,n=r.innerWidth;n-s<a?this.$menu.css({left:n-a}):this.$menu.css({left:s}),this.$menu.css({top:i})}clickInsideElement(e,t){let s=a(e.target);if(s.is(t))return s;let i=s.closest(t);return!!i.length&&i}getPosition(e=r.event){let t,s;return e.pageX||e.pageY?(t=e.pageX,s=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+n.body.scrollLeft+n.documentElement.scrollLeft,s=e.clientY+n.body.scrollTop+n.documentElement.scrollTop),{x:t,y:s}}}},7864:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Tree});var i=s(4967),a=s(3330),n=s(1721),r=s(6885),l=s(9755);class Tree extends i.default{_init(){return!(!this.options.$tree||!this.options.data_js_item)&&(this.coloringList(),!0)}addPageToLsTree(e,t){let s=r.__storage.get(e,[]);s.includes(t)||(t=[t],s=s.concat(t),r.__storage.set(e,s))}removePageFromLsTree(e,t){let s=r.__storage.get(e,[]);if(s.includes(t)){let i=s.indexOf(t);!1!==i&&s.splice(i,1),r.__storage.set(e,s)}}getDescendants(e,t="trash"){let s=e.data("js-id"),i=e.data("js-descendants-url"),n=l(`[data-js-sub-for="${s}"]`);return!e.is(".in-progress")&&(e.is(".opened")?(n.html(""),e.removeClass("opened"),this.coloringList(),this.removePageFromLsTree(`${t}-tree`,s),!1):(n.html(""),e.addClass("opened"),e.addClass("in-progress"),this.addPageToLsTree(`${t}-tree`,s),void new a.default({url:i,success:i=>{let a=this._nullSafe((()=>i.data.tree));if(a){let t=n.length?n:this.getUlTpl(s);l.each(a,((e,s)=>{this.options.$tree.find(`[data-js-id=${s.id}]`).remove();let i="";!1===this._nullSafe((()=>s.published))&&(i="off"),t.append(this.getLiTpl(s,i))})),t.insertAfter(e),this.coloringList(),e.addClass("tree__item_with-descendants opened")}else this.removePageFromLsTree(`${t}-tree`,s),e.removeClass("tree__item_with-descendants opened");setTimeout((()=>{e.removeClass("in-progress")}),600)}})))}addDescendant(e,t){let s=e.data("js-id");new n.default({route:t,data:{parent_id:s},callback:t=>{this._bindTo(t,"form:done",(()=>{e.addClass("tree__item_with-descendants"),this.getDescendants(e)}))}})}addRoot(e,t="a"){let s,i,a=this.options.$tree.find(" > li"),n="";!1===this._nullSafe((()=>e.published))&&(n="off");let r=this.getLiTpl(e,n);a.each(((e,a)=>{if(i)return!0;let n=l(a),r=l.trim(n.text()).toLowerCase(),d=l.trim(t).toLowerCase();(Number.isInteger(r)||r>d)&&(s=n,i=!0)})),s?r.insertBefore(s):this.options.$tree.append(r),this.coloringList()}getUlTpl(e){return l("<ul/>",{class:"tree__sub","data-js-sub-for":e})}getLiTpl(e,t=""){let s=l("<li/>",{"data-js-context-menu":"item","data-js":this.options.data_js_item,"data-js-id":e.id,"data-js-page-descendants":e.descendants_count,"data-js-edit-url":e.edit_url,"data-js-descendants-url":e.descendants_url}),i=e.name||e.h1;return s.html(l("<span/>").html(i).text()),s.prepend(l("<div/>",{class:"tree__pusher"})),e.descendants_count&&s.addClass("tree__item_with-descendants"),t&&s.addClass(t),s}coloringList(){this.options.$tree.find("li").each(((e,t)=>{let s=l(t),i=s.position().left,a=s.find(".tree__pusher");i?a.length?a.css({width:i,left:-i}):s.prepend(l("<div/>",{class:"tree__pusher"}).css({width:i,left:-i})):a.length&&a.css({width:0,left:0}),e%2==0?l(t).removeClass("odd even").addClass("odd"):l(t).removeClass("odd even").addClass("even")}))}}}}]);